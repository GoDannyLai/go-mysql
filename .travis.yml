dist: trusty
sudo: required
language: go

go:
  - 1.10.x
  - 1.11.x
  - 1.12.x
  # - TODO master

matrix:
  allow_failures:
    - go: master

before_cache:
  - go clean -testcache

cache:
  directories:
    - /home/travis/.cache/go-build
    - /home/travis/gopath/pkg

services:
  - mysql

install:
  # ensure that vendor/ is in sync with code and Gopkg.*
  - curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh
  - dep check
  - git status
  - git diff --exit-code

script:
  - make init
  - make test-travis

after_success:
  - bash <(curl -s https://codecov.io/bash) -X fix

notifications:
  email: false
  slack:
    on_success: change
    on_failure: always
    rooms:
      secure: AysgwfvVB+5AAwhTn0+m3yGywVeEWsBwu2KOGDBBB16T+5ktXxiWK16qMkRHazzruQcYAiM6IXtDz3xT9PMeROr1VmsmnAGPgxE1KOilVioFBqTUAKqxtx0KY5W/RBYgbUueBy2ugC7y3vwuzMq9VkmvQWiGp9Bl5Nm55kExLRc=
